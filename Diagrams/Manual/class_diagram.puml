@startuml Class_Diagram_Updated
'--- Styles ---
skinparam classAttributeIconSize 0
skinparam monochrome true
skinparam linetype ortho

'--- Enums ---
enum VehicleStatus {
    AVAILABLE
    IN_USE
    MAINTENANCE
}

'--- Classes ---

abstract class User {
    - userId: String
    - name: String
    - phoneNumber: String
    - idProofUrl: String
    + register(): bool
    + login(): bool
    + scanQR(code: String): void
    + viewHistory(): List<Trip>
    + initiateWalletRecharge(): void
}

class Student extends User {
    - rollNumber: String
    + getFeeAccountDetails(): String
}

class Staff extends User {
    - employeeId: String
    + getSalaryAccountDetails(): String
}

class Wallet {
    - balance: double
    - autoDeductEnabled: bool
    + addMoney(amount: double, method: PaymentMethod): bool
    + deductMoney(amount: double): bool
    + checkBalance(): double
    + updateBalance(): void
}

'--- Payment Strategy Pattern ---
abstract class PaymentMethod {
    + processPayment(amount: double): bool
}

class UPIPayment extends PaymentMethod {
    - upiId: String
    + processPayment(amount: double): bool
    + initiateTransaction(): void
    + verifyWithBank(): bool
}

class SalaryDeduction extends PaymentMethod {
    - employeeId: String
    + processPayment(amount: double): bool
    + verifyEmployeeAccount(): bool
    + scheduleDeduction(): void
}

class FeeAddition extends PaymentMethod {
    - studentRollNo: String
    + processPayment(amount: double): bool
    + verifyStudentAccount(): bool
    + addToFeeStructure(): void
}

'--- Vehicle Hierarchy ---
abstract class Vehicle {
    - vehicleId: String
    - qrCode: String
    - batteryLevel: int
    - gpsLocation: Coordinates
    - status: VehicleStatus
    + unlock(): void
    + lock(): void
    + updateStatus(status: VehicleStatus): void
    + getStatus(): VehicleStatus
    + getBatteryLevel(): int
    + getGPSLocation(): Coordinates
}

class Bicycle extends Vehicle {
    - gearCount: int
}

class Moped extends Vehicle {
    - fuelLevel: int
}

class SmartBike extends Vehicle {
    - electricRange: int
}

class ParkingLot {
    - lotId: String
    - capacity: int
    - currentCount: int
    + isBikeInside(gps: Coordinates): bool
    + updateAvailability(): void
}

class Trip {
    - tripId: String
    - startTime: DateTime
    - endTime: DateTime
    - distanceCovered: double
    - totalFare: double
    + startTrip(): void
    + endTrip(): void
    + calculateDuration(): Time
    + calculateDistance(): double
}

class RateCard {
    - baseRate: double
    - ratePer100m: double
    - dailyFine: double
    + calculateFare(distance: double, duration: Time): double
    + applyBaseRate(): double
    + applyDistanceRate(): double
    + checkDailyFine(): double
}

class Transaction {
    - transactionId: String
    - amount: double
    - timestamp: DateTime
    - type: String
}

class Feedback {
    - rating: int
    - comment: String
}

'--- Controller/Manager Class ---
class BikeRentalController {
    + initiateTrip(userId: String, qrCode: String): Trip
    + completeTrip(tripId: String): Transaction
    + processWalletRecharge(userId: String, amount: double, method: PaymentMethod): bool
}

'--- Relationships ---

User "1" *-- "1" Wallet : owns >
User "1" -- "0..*" Trip : takes >
User "1" -- "0..*" Vehicle : interacts with >

Wallet "1" -- "0..*" Transaction : records >

Trip "0..*" -- "1" Vehicle : uses >
Trip "1" -- "1" Transaction : generates >
Trip "1" *-- "0..1" Feedback : receives >
Trip ..> RateCard : uses pricing logic >

Transaction "1" -- "1" PaymentMethod : processed via >

Vehicle "0..*" -- "1" ParkingLot : docked at >
ParkingLot "1" o-- "0..*" Vehicle : aggregates >

'--- Controller Relationships ---
BikeRentalController ..> User : manages >
BikeRentalController ..> Trip : creates/manages >
BikeRentalController ..> Wallet : accesses >
BikeRentalController ..> Vehicle : controls >

'--- Specific Payment Associations ---
Staff ..> SalaryDeduction : authorized for >
Student ..> FeeAddition : authorized for >

@enduml