@startuml Start_Trip_with_QR_Scan

actor User
participant "App Interface" as App
participant ":User" as UserObj
participant ":Vehicle" as Bike
participant ":Wallet" as WalletObj
participant ":ParkingLot" as Parking
participant ":Trip" as TripObj

User -> App: scanQR(qrCode)
activate App

App -> UserObj: scanQR(qrCode)
activate UserObj

UserObj -> Bike: getStatus()
activate Bike

alt status == AVAILABLE
    Bike --> UserObj: statusAvailable
    
    UserObj -> Bike: getBatteryLevel()
    Bike --> UserObj: batteryLevel
    
    UserObj -> WalletObj: checkBalance()
    activate WalletObj
    
    alt balance >= minimumRequired
        WalletObj --> UserObj: sufficientBalance
        deactivate WalletObj
        
        UserObj -> Bike: unlock()
        Bike -> Bike: updateStatus(IN_USE)
        Bike --> UserObj: unlocked
        
        UserObj -> TripObj: create(user, vehicle)
        activate TripObj
        
        TripObj -> TripObj: startTrip()
        TripObj -> Bike: getGPSLocation()
        Bike --> TripObj: currentLocation
        
        TripObj --> UserObj: tripStarted
        deactivate TripObj
        
        UserObj --> App: tripInitiated
        App --> User: displayTripInterface()
        
    else balance < minimumRequired
        WalletObj --> UserObj: insufficientBalance
        deactivate WalletObj
        
        UserObj --> App: balanceInsufficient
        App --> User: promptAddMoney()
    end
    
else status != AVAILABLE
    Bike --> UserObj: vehicleUnavailable
    UserObj --> App: vehicleNotAvailable
    App --> User: displayErrorMessage()
end

deactivate Bike
deactivate UserObj
deactivate App

@enduml